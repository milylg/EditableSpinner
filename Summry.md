## Android动画

#### 动画应用范围

- 可绘制图形（drawable)制定动画（有两种方式定义动画：静态定义和动态定义）
- 为界面可见性和动作添加动画，帮助用户了解界面的变化情况。动画应尽可能运用现实世界的物理定律，以使其看起来更自然。例如，它们应在目标发生变化时保持动量，并在任何变化期间进行平稳过渡。为了提供这些行为，Android 支持库包含基于物理特性的动画 API，它们依靠物理定律来控制动画的发生方式。
  - 非基于物理特性的动画（例如使用 `ObjectAnimator` API 构建的动画）
  - 基于物理特性的动画（例如 `DynamicAnimation`），两种常见的基于物理特性的动画：弹跳动画和投掷动画。
- 为布局更改添加动画，需指定起始和结束布局以及要使用的动画类型。
- 在 Activity 之间添加动画。



#### 动画的类型

- 属性动画：定义一个随时间更改任何对象属性的动画，无论其是否绘制到屏幕上，属性动画会在指定时长内更改属性（对象中的字段）的值。它需要指定要添加动画效果的对象属性，例如对象在屏幕上的位置、动画效果持续多长时间以及要在哪些值之间添加动画效果。属性动画可以定义以下这些特性：
  - 时长：您可以指定动画的时长。默认时长为 300 毫秒。
  - 时间插值：您可以指定如何根据动画的当前已播放时长来计算属性的值。
  - 重复计数和行为：您可以指定是否在某个时长结束后重复播放动画以及重复播放动画多少次。您还可以指定是否要反向播放动画。如果将其设置为反向播放，则会先播放动画，然后反向播放动画，直到达到重复次数。
  - Animator 集：您可以将动画分成多个逻辑集，它们可以一起播放、按顺序播放或者在指定的延迟时间后播放。
  - 帧刷新延迟：您可以指定动画帧的刷新频率。默认设置为每 10 毫秒刷新一次，但应用刷新帧的速度最终取决于整个系统的繁忙程度以及系统为底层计时器提供服务的速度。
- 视图动画：如果想为非对象添加动画效果，则必须实现自己的代码才能做到。视图动画系统也存在一些限制，因为它仅公开对象的部分方面来供您添加动画效果；例如，您可以对视图的缩放和旋转添加动画效果，但无法对背景颜色这样做。



#### 属性动画和视图动画的区别

- 服务目标差别：视图动画系统仅提供为 `View` 对象添加动画效果的功能，属性动画可以为任何对象（视图和非视图）的任何属性添加动画效果，并且实际修改的是对象本身。
- 目标行为差别：视图动画只会在绘制视图的位置进行修改，而不会修改实际的视图本身。

属性动画系统在执行动画方面也更为强健。视图动画系统的设置需要的时间较短，需要编写的代码也较少。如果视图动画可以完成您需要执行的所有操作，或者现有代码已按照您需要的方式运行，则无需使用属性动画系统。在某些用例中，也可以针对不同的情况同时使用这两种动画系统。

在哪里可以找到动画系统的API

- 属性动画系统程序接口：`android.animation`包
- 视图动画系统程序接口：`android.view.animation`包



#### 动画类结构图

![](https://upload-images.jianshu.io/upload_images/2062943-6c2591171f8e3ca6.png?imageMogr2/auto-orient/strip|imageView2/2/w/747/format/webp)

Animator 类提供了创建动画的基本结构。通常不会直接使用此类，因为它只提供极少的功能，这些功能必须经过扩展才能全面支持为值添加动画效果。

- `ValueAnimator`：这个动画是针对属性的值进行动画的 ，不会对UI造成改变，不能直接实现动画效果。需要通过对动画的监听去做一些操作，在监听中将这个值设置给对应的属性，对应的属性才会改变。

- `ObjectAnimator`：直接动画所给的对象,他会调用对象对应属性的get/set方法吧属性的值设置给对象的属性，直接实现动画效果。

- `TimeAnimator`：这个也不直接实现动画效果，只是提供一个监听回调，返回动画执行的总时间，距离上次动画执行的时间等。
- `AnimatorSet`：提供一种将动画分组在一起的机制，以使它们彼此相对运行。您可以将动画设置为一起播放、按顺序播放或者在指定的延迟时间后播放。



#### 评估程序

| 类/接口          | 说明                                                         |
| ---------------- | ------------------------------------------------------------ |
| `IntEvaluator`   | 这是用于计算 `int` 属性的值的默认评估程序。                  |
| `FloatEvaluator` | 这是用于计算 `float` 属性的值的默认评估程序。                |
| `ArgbEvaluator`  | 这是用于计算颜色属性的值（用十六进制值表示）的默认评估程序。 |
| `TypeEvaluator`  | 此接口用于创建您自己的评估程序。如果您要添加动画效果的对象属性不是 `int`、`float` 或颜色，那么您必须实现 `TypeEvaluator` 接口，才能指定如何计算对象属性添加动画效果之后的值。如果您想以不同于默认行为的方式处理 `int`、`float`和颜色，您还可以为这些类型的值指定自定义 `TypeEvaluator`。如需详细了解如何编写自定义评估程序，请参阅使用 `TypeEvaluator`部分。 |



#### 插值器

| 类/接口                            | 说明                                                         |
| ---------------------------------- | ------------------------------------------------------------ |
| `AccelerateDecelerateInterpolator` | 该插值器的变化率在开始和结束时缓慢但在中间会加快。           |
| `AccelerateInterpolator`           | 该插值器的变化率在开始时较为缓慢，然后会加快。               |
| `AnticipateInterpolator`           | 该插值器先反向变化，然后再急速正向变化。                     |
| `AnticipateOvershootInterpolator`  | 该插值器先反向变化，再急速正向变化，然后超过定位值，最后返回到最终值。 |
| `BounceInterpolator`               | 该插值器的变化会跳过结尾处。                                 |
| `CycleInterpolator`                | 该插值器的动画会在指定数量的周期内重复。                     |
| `DecelerateInterpolator`           | 该插值器的变化率开始很快，然后减速。                         |
| `LinearInterpolator`               | 该插值器的变化率恒定不变。                                   |
| `OvershootInterpolator`            | 该插值器会急速正向变化，再超出最终值，然后返回。             |
| `TimeInterpolator`                 | 该接口用于实现您自己的插值器。                               |

实现 `TimeInterpolator` 接口并创建您自己的插值器。如需详细了解如何编写自定义插值器，请参阅[使用插值器](https://developer.android.google.cn/guide/topics/graphics/prop-animation?hl=zh-cn#interpolators)。





#### Android TextView支持的Html格式

| 格式             | 标签                                        |
| ---------------- | ------------------------------------------- |
| 粗体             | <b>、<em>                                   |
| 斜体             | <i>、<cite>、<dfn>                          |
| 文本放大 25%     | <big>                                       |
| 文本缩小 20%     | <small>                                     |
| 设置字体属性     | <font face="font_family" color="hex_color"> |
| 设置等宽字体系列 | <tt>                                        |
| 删除线           | <s>、<strike>、<del>                        |
| 下划线           | <u>                                         |
| 上标             | <sup>                                       |
| 下标             | <sub>                                       |
| 列表标记         | <ul>、<li>                                  |
| 换行符           | <br/>                                       |
| 区隔标记         | <div>                                       |



#### Android富文本编辑器调研

| 实现方式       | 优点                                                         | 缺点                                                         |
| -------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| EditText+Spans | TextView 原生支持诸如粗体、删除线、引用等 Span ，要实现简单的富文本编辑需求，可操作性还是比较大的 | 应用某些Span时，行高度变低，无法自定义自己需要的PopupMenu.支持的样式不够灵活，有些效果实现不了 |
| WebView + Js   | 只需要做好 WebView 和 JavaScript 的交互                      | 实现过程你需要解决 WebView 的兼容性问题（ Android 4.4 及其以上版本和 4.4 以下版本的 WebView 内核不一样），以及其他一些不可预见的问题 |
| 基于Layout布局 | 可扩展性强                                                   | 实现比较复杂，系统资源占用较多、卡顿                         |

[Spans，一个强大的概念[译文]](https://rocko.xyz/2015/03/04/【译】Spans，一个强大的概念/)

EditText + Span  imageSpan点击事件

有些Span是没有OnClick()接口的比如ImageSpan。解决方法有两个

- 在相同的位置设置**ClickableSpan**
- 自定义**LinkMovementMethod**